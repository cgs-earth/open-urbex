name: Test

on: [ push ]

jobs:
  main:
    runs-on: ubuntu-24.04

    steps:
    - uses: actions/checkout@v6
      with:
        submodules: true
    - name: Install system dependencies
      run: sudo apt-get update && sudo apt-get install -y libkrb5-dev
    - name: Install uv
      uses: astral-sh/setup-uv@v7.1.6
      with:
        # Install a specific version of uv.
        version: "0.8.12"
    - uses: actions/setup-python@v6
      name: Setup Python
      with:
          python-version-file: ".python-version"
    - name: Install the project
      run: uv sync --all-extras --dev  # --locked
    - name: Run tests
      run: uv run pytest --rootdir=Tests --cov=IO/Scripts Tests

    - name: failed tests ðŸš©
      if: ${{ failure() }}
      run: |
        pip3 list -v